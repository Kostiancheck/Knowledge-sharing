<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"></head><body><div style="background-color:#1e1f22;color:#bcbec4;font-family:'JetBrains Mono',monospace;font-size:8.3pt;white-space:pre;"><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;">%md<br></span><span style="color:#cf8e6d;">#&#32;</span>RDD<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#cf8e6d;">val&#32;</span>data&#32;=&#32;Seq(<span style="color:#2aacb8;">1</span>,&#32;<span style="color:#2aacb8;">2</span>,&#32;<span style="color:#2aacb8;">3</span>,&#32;<span style="color:#2aacb8;">4</span>,&#32;<span style="color:#2aacb8;">5</span>)<br><span style="color:#cf8e6d;">val&#32;</span>distData&#32;=&#32;<span style="color:#c77dbb;font-style:italic;">sc</span>.parallelize(data)<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;">//&#32;transformations&#32;only<br></span><span style="color:#7a7e85;"><br></span><span style="color:#cf8e6d;">val&#32;</span>squares&#32;=&#32;distData<br><span style="color:#7a7e85;">//&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.map(x&#32;=&gt;&#32;x.toString)<br></span><span style="color:#7a7e85;">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</span>.map(x&#32;=&gt;&#32;x&#32;*&#32;x)<br><br><span style="color:#cf8e6d;">val&#32;</span>filtered&#32;=&#32;squares<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.filter(x&#32;=&gt;&#32;x&#32;%&#32;<span style="color:#2aacb8;">2&#32;</span>==&#32;<span style="color:#2aacb8;">0</span>)<br><br><br><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;">//filtered.collect().foreach(println)<br></span><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;">//&#32;action.&#32;DAG&#32;created,&#32;transformations&#32;executed<br></span><span style="color:#cf8e6d;">val&#32;</span>sum_res&#32;=&#32;filtered<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.reduce(_&#32;+&#32;_)<br><br><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;">%md<br></span><span style="color:#cf8e6d;">#&#32;</span>DataFrames&#32;and&#32;Datasets&#32;in&#32;JSON<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#cf8e6d;">import&#32;</span><span style="color:#c77dbb;font-style:italic;">spark</span>.implicits._<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#cf8e6d;">val&#32;</span>data1&#32;=&#32;Seq((<span style="color:#6aab73;">"1"</span>,&#32;<span style="color:#6aab73;">"Java"</span>,&#32;<span style="color:#6aab73;">"20000"</span>),<br>&#32;&#32;&#32;&#32;(<span style="color:#6aab73;">"2"</span>,&#32;<span style="color:#6aab73;">"Python"</span>,&#32;<span style="color:#6aab73;">"100000"</span>),<br>&#32;&#32;&#32;&#32;(<span style="color:#6aab73;">"3"</span>,&#32;<span style="color:#6aab73;">"Scala"</span>,&#32;<span style="color:#6aab73;">"3000"</span>))<br><br><span style="color:#cf8e6d;">val&#32;</span>data2&#32;=&#32;Seq((<span style="color:#6aab73;">"1"</span>,&#32;<span style="color:#6aab73;">"studentA"</span>),<br>&#32;&#32;&#32;&#32;(<span style="color:#6aab73;">"1"</span>,&#32;<span style="color:#6aab73;">"studentB"</span>),<br>&#32;&#32;&#32;&#32;(<span style="color:#6aab73;">"2"</span>,&#32;<span style="color:#6aab73;">"studentA"</span>),<br>&#32;&#32;&#32;&#32;(<span style="color:#6aab73;">"3"</span>,&#32;<span style="color:#6aab73;">"studentC"</span>))<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;"><br></span><span style="color:#7a7e85;">//&#32;Create&#32;languages&#32;DF<br></span>data1<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.toDF(<span style="color:#6aab73;">"id"</span>,&#32;<span style="color:#6aab73;">"language"</span>,&#32;<span style="color:#6aab73;">"tution_fees"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.write<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.mode(<span style="color:#6aab73;">"overwrite"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.json(<span style="color:#6aab73;">"s3://tv-datascience-lab/kostia/test_json/language/"</span>)<br><br><span style="color:#cf8e6d;">val&#32;</span>languagesJson&#32;=&#32;<span style="color:#c77dbb;font-style:italic;">spark<br></span><span style="color:#c77dbb;font-style:italic;">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</span>.read<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.json(<span style="color:#6aab73;">"s3://tv-datascience-lab/kostia/test_json/language/"</span>)<br><br><span style="color:#7a7e85;">//&#32;Create&#32;students&#32;DF<br></span>data2<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.toDF(<span style="color:#6aab73;">"language_id"</span>,&#32;<span style="color:#6aab73;">"studentName"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.write<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.mode(<span style="color:#6aab73;">"overwrite"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.json(<span style="color:#6aab73;">"s3://tv-datascience-lab/kostia/test_json/student/"</span>)<br><br><span style="color:#cf8e6d;">val&#32;</span>studentsJson&#32;=&#32;<span style="color:#c77dbb;font-style:italic;">spark<br></span><span style="color:#c77dbb;font-style:italic;">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</span>.read<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.json(<span style="color:#6aab73;">"s3://tv-datascience-lab/kostia/test_json/student/"</span>)<br><br><span style="color:#7a7e85;">//languagesJson:&#32;org.apache.spark.sql.DataFrame&#32;=&#32;[id:&#32;string,&#32;language:&#32;string&#32;...&#32;1&#32;more&#32;field]<br></span><span style="color:#7a7e85;">//studentsJson:&#32;org.apache.spark.sql.DataFrame&#32;=&#32;[language_id:&#32;string,&#32;studentName:&#32;string]<br></span><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;"><br></span><span style="color:#7a7e85;"><hr><br></span>languagesJson.printSchema()<br><span style="font-style:italic;">println</span>(<span style="color:#6aab73;">"-----------------------"</span>)<br>studentsJson.printSchema()<br><span style="color:#7a7e85;">//root<br></span><span style="color:#7a7e85;">//&#32;|--&#32;id:&#32;string&#32;(nullable&#32;=&#32;true)<br></span><span style="color:#7a7e85;">//&#32;|--&#32;language:&#32;string&#32;(nullable&#32;=&#32;true)<br></span><span style="color:#7a7e85;">//&#32;|--&#32;tution_fees:&#32;string&#32;(nullable&#32;=&#32;true)<br></span><span style="color:#7a7e85;">//<br></span><span style="color:#7a7e85;">//-----------------------<br></span><span style="color:#7a7e85;">//root<br></span><span style="color:#7a7e85;">//&#32;|--&#32;language_id:&#32;string&#32;(nullable&#32;=&#32;true)<br></span><span style="color:#7a7e85;">//&#32;|--&#32;studentName:&#32;string&#32;(nullable&#32;=&#32;true)<br></span><span style="color:#7a7e85;"><hr><br></span>languagesJson.show(<span style="color:#cf8e6d;">false</span>)<br><span style="font-style:italic;">println</span>(<span style="color:#6aab73;">"-----------------------"</span>)<br>studentsJson.show(<span style="color:#cf8e6d;">false</span>)<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#cf8e6d;">val&#32;</span>dfJson&#32;=<br>&#32;&#32;&#32;&#32;studentsJson<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.join(languagesJson,&#32;studentsJson(<span style="color:#6aab73;">"language_id"</span>)&#32;===&#32;languagesJson(<span style="color:#6aab73;">"id"</span>))<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.filter(<span style="color:#6aab73;">$"studentName"&#32;</span>===&#32;<span style="color:#6aab73;">"studentA"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.groupBy(<span style="color:#6aab73;">$"studentName"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.agg(sum(<span style="color:#6aab73;">$"language_id"</span>).alias(<span style="color:#6aab73;">"c"</span>))<br><span style="color:#7a7e85;"><hr><br></span>dfJson.printSchema()<br><span style="color:#7a7e85;"><hr><br></span>dfJson.explain(<span style="color:#cf8e6d;">true</span>)<br><span style="color:#7a7e85;"><hr><br></span>dfJson.show(<span style="color:#cf8e6d;">false</span>)<br><span style="color:#7a7e85;"><hr><br></span>dfJson.count()<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;">%md<br></span><span style="color:#cf8e6d;">#&#32;</span>DataFrames&#32;and&#32;Datasets&#32;in&#32;parquet<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;"><br></span><span style="color:#7a7e85;"><br></span><span style="color:#7a7e85;"><br></span><span style="color:#7a7e85;">//&#32;Create&#32;languages&#32;DF<br></span>data1<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.toDF(<span style="color:#6aab73;">"id"</span>,&#32;<span style="color:#6aab73;">"language"</span>,&#32;<span style="color:#6aab73;">"tution_fees"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.write<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.mode(<span style="color:#6aab73;">"overwrite"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.parquet(<span style="color:#6aab73;">"s3://tv-datascience-lab/kostia/test/language/"</span>)<br><br><span style="color:#cf8e6d;">val&#32;</span>languagesPar&#32;=&#32;<span style="color:#c77dbb;font-style:italic;">spark<br></span><span style="color:#c77dbb;font-style:italic;">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</span>.read<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.parquet(<span style="color:#6aab73;">"s3://tv-datascience-lab/kostia/test/language/"</span>)<br><br><span style="color:#7a7e85;">//&#32;Create&#32;students&#32;DF<br></span>data2<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.toDF(<span style="color:#6aab73;">"language_id"</span>,&#32;<span style="color:#6aab73;">"studentName"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.write<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.partitionBy(<span style="color:#6aab73;">"studentName"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.mode(<span style="color:#6aab73;">"overwrite"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.parquet(<span style="color:#6aab73;">"s3://tv-datascience-lab/kostia/test/student/"</span>)<br><br><span style="color:#cf8e6d;">val&#32;</span>studentsPar&#32;=&#32;<span style="color:#c77dbb;font-style:italic;">spark<br></span><span style="color:#c77dbb;font-style:italic;">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</span>.read<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.parquet(<span style="color:#6aab73;">"s3://tv-datascience-lab/kostia/test/student/"</span>)<br><br><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;">%sh<br></span><span style="color:#c57633;">aws&#32;</span>s3&#32;ls&#32;s3://tv-datascience-lab/kostia/test/student/<br><span style="color:#7a7e85;"><hr><br></span>languagesPar.printSchema()<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;"><br></span><span style="color:#7a7e85;"><br></span><span style="color:#7a7e85;">//&#32;Join&#32;tables<br></span><span style="color:#cf8e6d;">val&#32;</span>df&#32;=<br>&#32;&#32;&#32;&#32;studentsPar<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.join(languagesPar,&#32;studentsPar(<span style="color:#6aab73;">"language_id"</span>)&#32;===&#32;languagesPar(<span style="color:#6aab73;">"id"</span>))<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.filter(<span style="color:#6aab73;">$"studentName"&#32;</span>===&#32;<span style="color:#6aab73;">"studentA"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.groupBy(<span style="color:#6aab73;">$"studentName"</span>)<br>&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.agg(sum(<span style="color:#6aab73;">$"language_id"</span>).alias(<span style="color:#6aab73;">"c"</span>))&#32;<br><br><br><span style="color:#7a7e85;"><hr><br></span>df.printSchema()<br><span style="color:#7a7e85;"><hr><br></span>df.explain(extended=<span style="color:#cf8e6d;">true</span>)<br><br><span style="color:#7a7e85;"><hr><br></span>df.show(<span style="color:#cf8e6d;">false</span>)<br><span style="color:#7a7e85;"><hr><br></span>df.count()<br><span style="color:#7a7e85;"><hr><br></span><span style="color:#7a7e85;"><br></span><span style="color:#7a7e85;">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<br></span><span style="color:#7a7e85;">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;</span></div></body></html>